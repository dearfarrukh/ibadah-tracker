<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ibadah Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>

body{
font-family:-apple-system,BlinkMacSystemFont;
background-image:url("wallpaper.jpg");
background-size:cover;
background-position:center;
background-repeat:no-repeat;
background-attachment:fixed;
margin:0;
padding:20px;
}

.card{
background:rgba(255,255,255,0.6);
backdrop-filter:blur(20px);
padding:18px;
border-radius:22px;
margin-bottom:20px;
}

button{
background:#007aff;
color:white;
border:none;
padding:12px;
border-radius:16px;
margin-top:10px;
width:100%;
}

.task{
display:flex;
justify-content:space-between;
padding:8px 0;
}

input[type="checkbox"]{
width:22px;
height:22px;
}

</style>
</head>

<body>

<h1 style="text-align:center;">üìø Ibadah Tracker</h1>

<div class="card">
<h3>üìÖ Select Date</h3>

<div style="display:flex;align-items:center;gap:10px;">

<button onclick="prevDay()" style="width:60px;">‚¨ÖÔ∏è</button>

<input type="date" id="datePicker"
onchange="manualPickDate(this.value)"
style="position:absolute;opacity:0;width:0;height:0;">

<div onclick="document.getElementById('datePicker').showPicker()"
style="flex:1;text-align:center;cursor:pointer;">

<div id="displayDate"
style="font-weight:600;font-size:18px;"></div>

<div id="hijriDate"
style="font-size:14px;opacity:0.7;"></div>

</div>

<button onclick="nextDay()" style="width:60px;">‚û°Ô∏è</button>

</div>
</div>

<div class="card">
<h3>üìù Daily Tasks</h3>
<div id="taskContainer"></div>
</div>

<div class="card">
<h3>üî• Streak</h3>
<p id="streakCount">0 Days</p>
</div>

<script>

let taskList=JSON.parse(localStorage.getItem("taskList"))||[
"Fajr","Dhuhur","Asr","Maghrib","Isha",
"Surah Mulk","Surah Sajdah","Surah Yaseen",
"Surah Rehman","Surah Taghabun","Surah Waqiya"
];

function islamicToday(){
let now=new Date();
let d=new Date(now.getFullYear(),now.getMonth(),now.getDate());
if(now.getHours()<2){
d.setDate(d.getDate()-1);
}
return d;
}

function formatKey(d){
return d.getFullYear()+"-"+
String(d.getMonth()+1).padStart(2,"0")+"-"+
String(d.getDate()).padStart(2,"0");
}

function getLocalDate(){
let v=document.getElementById("datePicker").value;
let p=v.split("-");
return new Date(p[0],p[1]-1,p[2]);
}

function setDate(date){

document.getElementById("datePicker").value=formatKey(date);

document.getElementById("displayDate").innerText=
date.toLocaleDateString(
'en-US',
{weekday:'long',year:'numeric',month:'short',day:'numeric'}
);

document.getElementById("hijriDate").innerText=
new Intl.DateTimeFormat(
'en-TN-u-ca-islamic',
{day:'numeric',month:'long',year:'numeric'}
).format(date);

loadTasks();
}

function loadTasks(){

let d=getLocalDate();
let key=formatKey(d);
let saved=JSON.parse(localStorage.getItem(key))||{};

let container=document.getElementById("taskContainer");
container.innerHTML="";

taskList.forEach(task=>{
let div=document.createElement("div");
div.className="task";
div.innerHTML=`
<label>${task}</label>
<input type="checkbox"
${saved[task]?"checked":""}
onchange="toggleTask('${task}',this.checked)">
`;
container.appendChild(div);
});

updateStreak();
}

function toggleTask(task,status){

let d=getLocalDate();
let key=formatKey(d);

let saved=JSON.parse(localStorage.getItem(key))||{};
saved[task]=status;
localStorage.setItem(key,JSON.stringify(saved));

updateStreak();
}

function prevDay(){
let d=getLocalDate();
d.setDate(d.getDate()-1);
setDate(d);
}

function nextDay(){
let d=getLocalDate();
d.setDate(d.getDate()+1);
setDate(d);
}

function manualPickDate(value){
let p=value.split("-");
let d=new Date(p[0],p[1]-1,p[2]);
setDate(d);
}

function updateStreak(){

let streak=0;
let today=islamicToday();

for(let i=0;i<365;i++){
let d=new Date(today);
d.setDate(today.getDate()-i);

let key=formatKey(d);
let saved=JSON.parse(localStorage.getItem(key));

if(saved && Object.values(saved).every(v=>v===true)){
streak++;
}else break;
}

document.getElementById("streakCount").innerText=
streak+" Days";
}

window.onload=function(){
setDate(islamicToday());
}

</script>

</body>
</html>