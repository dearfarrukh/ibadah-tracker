<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ibadah Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<style>

body{
font-family:-apple-system,BlinkMacSystemFont;
background-image:url("wallpaper.jpg");
background-size:cover;
background-position:center;
background-repeat:no-repeat;
background-attachment:fixed;
margin:0;
padding:20px;
}

.card{
background:rgba(255,255,255,0.6);
backdrop-filter:blur(20px);
padding:18px;
border-radius:22px;
margin-bottom:20px;
}

h1{text-align:center;}

.task{
display:flex;
justify-content:space-between;
padding:8px 0;
}

button{
background:#007aff;
color:white;
border:none;
padding:10px;
border-radius:12px;
}

input[type="checkbox"]{
width:22px;
height:22px;
accent-color:#007aff;
}

</style>
</head>

<body>

<h1>üìø Ibadah Tracker</h1>

<div class="card">
<h3>üìÖ Select Date</h3>
<div style="display:flex;align-items:center;gap:10px;">
<button onclick="prevDay()">‚¨ÖÔ∏è</button>
<input type="date" id="datePicker" style="display:none;">
<div id="displayDate" style="flex:1;text-align:center;font-weight:600;"></div>
<button onclick="nextDay()">‚û°Ô∏è</button>
</div>
</div>

<div class="card">
<h3>üìù Daily Tasks</h3>
<div id="taskContainer"></div>
</div>

<div class="card">
<h3>üî• Streak</h3>
<p id="streakCount">0 Days</p>
</div>

<script>

// üî¥ STOP UTC BUG (IMPORTANT)
function formatLocalDate(date){
let y=date.getFullYear();
let m=(date.getMonth()+1).toString().padStart(2,"0");
let d=date.getDate().toString().padStart(2,"0");
return `${y}-${m}-${d}`;
}

// üåô Islamic Day Logic
function getIslamicDay(){
let now=new Date();
let today=new Date();
if(now.getHours()<2){
today.setDate(today.getDate()-1);
}
return today;
}

// üìÖ Show Day Name
function updateDisplayDate(){
let picker=document.getElementById("datePicker");
let d=new Date(picker.value+"T00:00");
let day=d.toLocaleDateString('en-US',{weekday:'long'});
let date=d.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
document.getElementById("displayDate").innerText=date+" ‚Äî "+day;
}

let taskList=JSON.parse(localStorage.getItem("taskList"))||[
"Fajr","Dhuhur","Asr","Maghrib","Isha",
"Surah Mulk","Surah Sajdah","Surah Yaseen",
"Surah Rehman","Surah Taghabun","Surah Waqiya"
];

function getSelectedDate(){
return document.getElementById("datePicker").value;
}

function loadTasks(){
let container=document.getElementById("taskContainer");
container.innerHTML="";
let date=getSelectedDate();
let saved=JSON.parse(localStorage.getItem(date))||{};

taskList.forEach(task=>{
let div=document.createElement("div");
div.className="task";
div.innerHTML=`<label>${task}</label>
<input type="checkbox" ${saved[task]?"checked":""}
onchange="toggleTask('${task}',this.checked)">`;
container.appendChild(div);
});

updateStreak();
updateDisplayDate();
}

function toggleTask(task,status){
let saved=JSON.parse(localStorage.getItem(getSelectedDate()))||{};
saved[task]=status;
localStorage.setItem(getSelectedDate(),JSON.stringify(saved));
updateStreak();
}

function prevDay(){
let picker=document.getElementById("datePicker");
let date=new Date(picker.value+"T00:00");
date.setDate(date.getDate()-1);
picker.value=formatLocalDate(date);
loadTasks();
}

function nextDay(){
let picker=document.getElementById("datePicker");
let date=new Date(picker.value+"T00:00");
date.setDate(date.getDate()+1);
picker.value=formatLocalDate(date);
loadTasks();
}

function updateStreak(){
let streak=0;
let today=getIslamicDay();

for(let i=0;i<365;i++){
let d=new Date(today);
d.setDate(today.getDate()-i);
let key=formatLocalDate(d);
let saved=JSON.parse(localStorage.getItem(key));
if(saved && Object.values(saved).every(v=>v===true)){
streak++;
}else break;
}

document.getElementById("streakCount").innerText=streak+" Days";
}

// üü¢ Initial Set
let islamicToday=getIslamicDay();
document.getElementById("datePicker").value=formatLocalDate(islamicToday);
loadTasks();

// üîÑ Auto Change After 2AM if app stays open
setInterval(()=>{
let now=getIslamicDay();
let picker=document.getElementById("datePicker").value;
if(picker!==formatLocalDate(now)){
document.getElementById("datePicker").value=formatLocalDate(now);
loadTasks();
}
},60000);

</script>

</body>
</html>

