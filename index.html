<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ibadah Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body{
font-family:-apple-system,BlinkMacSystemFont;
background:url("wallpaper.jpg") center/cover no-repeat fixed;
margin:0;
padding:20px;
}

.card{
background:rgba(255,255,255,0.6);
backdrop-filter:blur(20px);
padding:18px;
border-radius:22px;
margin-bottom:20px;
}

button{
background:#007aff;
color:white;
border:none;
padding:12px;
border-radius:16px;
width:60px;
}

.task{
display:flex;
justify-content:space-between;
padding:8px 0;
}

input[type="checkbox"]{
width:22px;
height:22px;
}

#calendarBtn{
font-size:22px;
background:none;
width:auto;
color:black;
}

#datePicker{
display:none;
}
</style>
</head>

<body>

<h1 style="text-align:center;">ğŸ“¿ Ibadah Tracker</h1>

<div class="card">

<h3>
<button id="calendarBtn" onclick="openCalendar()">ğŸ“…</button>
Select Date
</h3>

<div style="display:flex;align-items:center;gap:10px;">

<button onclick="prevDay()">â¬…ï¸</button>

<div style="flex:1;text-align:center;">
<div id="displayDate" style="font-weight:600;"></div>
<div id="hijriDate" style="font-size:14px;color:gray;"></div>
</div>

<button onclick="nextDay()">â¡ï¸</button>

</div>

<input type="date" id="datePicker"
onchange="calendarPicked(this.value)">

</div>

<div class="card">
<h3>ğŸ“ Daily Tasks</h3>
<div id="taskContainer"></div>
</div>

<div class="card">
<h3>âš™ï¸ Task Settings</h3>

<select id="actionSelect" onchange="handleAction()">
<option value="">Select Action</option>
<option value="add">â• Add Task</option>
<option value="delete">ğŸ—‘ Delete Task</option>
<option value="rename">âœï¸ Rename Task</option>
</select>

<div id="actionArea"></div>

<h4>â˜ï¸ iCloud Backup</h4>
<button onclick="exportBackup()" style="width:100%;margin-bottom:10px;">Export</button>

<input type="file" id="restoreFile" onchange="importBackup()" style="display:none;">
<button onclick="document.getElementById('restoreFile').click()" style="width:100%">Restore</button>

</div>

<div class="card">
<h3>ğŸ”¥ Streak</h3>
<p id="streakCount">0 Days</p>
</div>

<script>

let currentDate;

let taskList=JSON.parse(localStorage.getItem("taskList"))||[
"Fajr","Dhuhur","Asr","Maghrib","Isha",
"Surah Mulk","Surah Sajdah","Surah Yaseen",
"Surah Rehman","Surah Taghabun","Surah Waqiya"
];

function islamicToday(){
let now=new Date();
let d=new Date(now.getFullYear(),now.getMonth(),now.getDate());
if(now.getHours()<2){d.setDate(d.getDate()-1);}
return d;
}

function formatKey(d){
return d.getFullYear()+"-"+
String(d.getMonth()+1).padStart(2,"0")+"-"+
String(d.getDate()).padStart(2,"0");
}

function setDate(d){

currentDate=d;

document.getElementById("displayDate").innerText=
d.toLocaleDateString('en-US',{
weekday:'long',
year:'numeric',
month:'short',
day:'numeric'
});

document.getElementById("hijriDate").innerText=
new Intl.DateTimeFormat('en-TN-u-ca-islamic',{
day:'numeric',
month:'long',
year:'numeric'
}).format(d)+" AH";

document.getElementById("datePicker").value=formatKey(d);

loadTasks();
}

function openCalendar(){

let picker=document.getElementById("datePicker");

picker.style.opacity="0";
picker.style.position="absolute";
picker.style.left="-9999px";

picker.focus();
picker.click();

}
function prevDay(){
currentDate.setDate(currentDate.getDate()-1);
setDate(new Date(currentDate));
}

function nextDay(){
currentDate.setDate(currentDate.getDate()+1);
setDate(new Date(currentDate));
}

function manualPick(v){
let p=v.split("-");
setDate(new Date(p[0],p[1]-1,p[2]));
}

function loadTasks(){

let key=formatKey(currentDate);
let saved=JSON.parse(localStorage.getItem(key))||{};

let container=document.getElementById("taskContainer");
container.innerHTML="";

taskList.forEach(task=>{
let div=document.createElement("div");
div.className="task";
div.innerHTML=`
<label>${task}</label>
<input type="checkbox"
${saved[task]?"checked":""}
onchange="toggleTask('${task}',this.checked)">
`;
container.appendChild(div);
});
updateStreak();
}

function toggleTask(task,status){
let key=formatKey(currentDate);
let saved=JSON.parse(localStorage.getItem(key))||{};
saved[task]=status;
localStorage.setItem(key,JSON.stringify(saved));
updateStreak();
}

function updateStreak(){
let streak=0;
let today=islamicToday();
for(let i=0;i<365;i++){
let d=new Date(today);
d.setDate(today.getDate()-i);
let key=formatKey(d);
let saved=JSON.parse(localStorage.getItem(key));
if(saved && Object.values(saved).every(v=>v===true)){streak++;}
else break;
}
document.getElementById("streakCount").innerText=streak+" Days";
}

function handleAction(){
let action=document.getElementById("actionSelect").value;
let area=document.getElementById("actionArea");
area.innerHTML="";
if(action==="add"){
area.innerHTML=`<input id="newTaskName"><button onclick="confirmAdd()">Add</button>`;
}
if(action==="delete"){
let opt=taskList.map(t=>`<option>${t}</option>`).join("");
area.innerHTML=`<select id="deleteTaskSelect">${opt}</select><button onclick="confirmDelete()">Delete</button>`;
}
if(action==="rename"){
let opt=taskList.map(t=>`<option>${t}</option>`).join("");
area.innerHTML=`<select id="renameSelect">${opt}</select><input id="renameInput"><button onclick="confirmRename()">Rename</button>`;
}
}

function confirmAdd(){
let n=document.getElementById("newTaskName").value.trim();
if(n){
taskList.push(n);
localStorage.setItem("taskList",JSON.stringify(taskList));
loadTasks();
}
}

function confirmDelete(){
let t=document.getElementById("deleteTaskSelect").value;
taskList=taskList.filter(x=>x!==t);
localStorage.setItem("taskList",JSON.stringify(taskList));
loadTasks();
}

function confirmRename(){
let o=document.getElementById("renameSelect").value;
let n=document.getElementById("renameInput").value.trim();
if(n){
taskList=taskList.map(t=>t===o?n:t);
localStorage.setItem("taskList",JSON.stringify(taskList));
loadTasks();
}
}

function exportBackup(){
let data={taskList,storage:{}};
for(let i=0;i<localStorage.length;i++){
let key=localStorage.key(i);
data.storage[key]=localStorage.getItem(key);
}
let blob=new Blob([JSON.stringify(data)]);
let url=URL.createObjectURL(blob);
let a=document.createElement("a");
a.href=url;
a.download="backup.json";
a.click();
}

function importBackup(){
let file=document.getElementById("restoreFile").files[0];
let r=new FileReader();
r.onload=e=>{
let data=JSON.parse(e.target.result);
localStorage.clear();
for(let k in data.storage){
localStorage.setItem(k,data.storage[k]);
}
location.reload();
};
r.readAsText(file);
}

window.onload=function(){
setDate(islamicToday());
}
function calendarPicked(value){

let p=value.split("-");
let d=new Date(p[0],p[1]-1,p[2]);

setDate(d);

}
</script>

</body>
</html>
