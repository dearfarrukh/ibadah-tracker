<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ibadah Tracker Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" href="icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<style>
body{
font-family:-apple-system,BlinkMacSystemFont;
background:linear-gradient(135deg,#e0e7ff,#f8fafc);
margin:0;
padding:20px;
animation:fadeIn 0.6s ease-in-out;
}

@keyframes fadeIn{
from{opacity:0; transform:translateY(10px);}
to{opacity:1; transform:translateY(0);}
}

h1{
text-align:center;
font-weight:600;
margin-bottom:25px;
}

.card{
background:rgba(255,255,255,0.6);
backdrop-filter:blur(20px);
-webkit-backdrop-filter:blur(20px);
padding:18px;
border-radius:22px;
box-shadow:0 10px 30px rgba(0,0,0,0.08);
margin-bottom:20px;
transition:all 0.3s ease;
}

button{
background:linear-gradient(135deg,#007aff,#0051ff);
color:white;
border:none;
padding:12px;
border-radius:16px;
margin-top:10px;
width:100%;
font-weight:600;
}

input,select{
width:100%;
padding:12px;
border-radius:16px;
border:none;
margin-top:8px;
background:rgba(255,255,255,0.7);
}

.task{
display:flex;
justify-content:space-between;
align-items:center;
padding:8px 0;
}

input[type="checkbox"]{
width:22px;
height:22px;
accent-color:#007aff;
}
</style>

<body>

<h1>üìø Ibadah Tracker</h1>

<div class="card">
<h3>üìÖ Select Date</h3>
<div style="display:flex;align-items:center;gap:10px;">
<button onclick="prevDay()" style="width:60px;">‚¨ÖÔ∏è</button>
<input type="date" id="datePicker" onchange="loadTasks()">
<button onclick="nextDay()" style="width:60px;">‚û°Ô∏è</button>
</div>
</div>

<div class="card">
<h3>üìù Daily Tasks</h3>
<div id="taskContainer"></div>
</div>

<div class="card">
<h3>‚öôÔ∏è Task Settings</h3>

<select id="actionSelect" onchange="handleAction()">
<option value="">Select Action</option>
<option value="add">‚ûï Add Task</option>
<option value="delete">üóë Delete Task</option>
<option value="rename">‚úèÔ∏è Rename Task</option>
</select>

<div id="actionArea"></div>

<h4>‚òÅÔ∏è iCloud Backup</h4>
<button onclick="exportBackup()">Export to iCloud</button>
<input type="file" id="restoreFile" onchange="importBackup()" style="display:none;">
<button onclick="document.getElementById('restoreFile').click()">Restore from iCloud</button>

</div>

<div class="card">
<h3>üî• Streak</h3>
<p id="streakCount">0 Days</p>
</div>

<div class="card">
<h3>üìä Monthly Report</h3>
<p id="monthlyReport"></p>
</div>

<script>

let taskList = JSON.parse(localStorage.getItem("taskList")) || [
"Fajr","Dhuhur","Asr","Maghrib","Isha",
"Surah Mulk","Surah Sajdah","Surah Yaseen",
"Surah Rehman","Surah Taghabun","Surah Waqiya"
];

document.getElementById("datePicker").valueAsDate = new Date();

function getSelectedDate(){
return document.getElementById("datePicker").value;
}

function loadTasks(){
let container=document.getElementById("taskContainer");
container.innerHTML="";
let date=getSelectedDate();
let saved=JSON.parse(localStorage.getItem(date))||{};

taskList.forEach(task=>{
let div=document.createElement("div");
div.className="task";
div.innerHTML=`<label>${task}</label>
<input type="checkbox" ${saved[task]?"checked":""}
onchange="toggleTask('${task}',this.checked)">`;
container.appendChild(div);
});

updateStreak();
updateMonthlyReport();
}

function toggleTask(task,status){
let saved=JSON.parse(localStorage.getItem(getSelectedDate()))||{};
saved[task]=status;
localStorage.setItem(getSelectedDate(),JSON.stringify(saved));
updateStreak();
updateMonthlyReport();
}

function handleAction(){
let action=document.getElementById("actionSelect").value;
let area=document.getElementById("actionArea");
area.innerHTML="";

if(action==="add"){
area.innerHTML=`<input type="text" id="newTaskName" placeholder="Enter task name">
<button onclick="confirmAdd()">Add</button>`;
}

if(action==="delete"){
let options=taskList.map(t=>`<option value="${t}">${t}</option>`).join("");
area.innerHTML=`<select id="deleteTaskSelect">${options}</select>
<button onclick="confirmDelete()">Delete</button>`;
}

if(action==="rename"){
let options=taskList.map(t=>`<option value="${t}">${t}</option>`).join("");
area.innerHTML=`<select id="renameSelect">${options}</select>
<input type="text" id="renameInput" placeholder="New name">
<button onclick="confirmRename()">Rename</button>`;
}
}

function confirmAdd(){
let name=document.getElementById("newTaskName").value.trim();
if(name && !taskList.includes(name)){
taskList.push(name);
localStorage.setItem("taskList",JSON.stringify(taskList));
loadTasks();
}
}

function confirmDelete(){
let task=document.getElementById("deleteTaskSelect").value;
taskList=taskList.filter(t=>t!==task);
localStorage.setItem("taskList",JSON.stringify(taskList));
loadTasks();
}

function confirmRename(){
let oldName=document.getElementById("renameSelect").value;
let newName=document.getElementById("renameInput").value.trim();
if(newName){
taskList=taskList.map(t=>t===oldName?newName:t);
localStorage.setItem("taskList",JSON.stringify(taskList));
loadTasks();
}
}

function updateStreak(){
let streak=0;
let today=new Date();

for(let i=0;i<365;i++){
let date=new Date();
date.setDate(today.getDate()-i);
let key=date.toISOString().split("T")[0];
let saved=JSON.parse(localStorage.getItem(key));
if(saved && Object.values(saved).every(v=>v===true)){
streak++;
}else break;
}

document.getElementById("streakCount").innerText=streak+" Days";
}

function updateMonthlyReport(){
let today=new Date();
let month=today.getMonth();
let year=today.getFullYear();
let completed=0;

for(let i=1;i<=31;i++){
let date=new Date(year,month,i);
if(date.getMonth()!==month) break;
let key=date.toISOString().split("T")[0];
let saved=JSON.parse(localStorage.getItem(key));
if(saved && Object.values(saved).every(v=>v===true)){
completed++;
}
}

document.getElementById("monthlyReport").innerText=
"Perfect Days This Month: "+completed;
}

function exportBackup(){
let data={taskList:taskList,storage:{}};
for(let i=0;i<localStorage.length;i++){
let key=localStorage.key(i);
data.storage[key]=localStorage.getItem(key);
}
let blob=new Blob([JSON.stringify(data)],{type:"application/json"});
let url=URL.createObjectURL(blob);
let a=document.createElement("a");
a.href=url;
a.download="ibadah-backup.json";
a.click();
}

function importBackup(){
let file=document.getElementById("restoreFile").files[0];
let reader=new FileReader();
reader.onload=function(e){
let data=JSON.parse(e.target.result);
localStorage.clear();
for(let key in data.storage){
localStorage.setItem(key,data.storage[key]);
}
location.reload();
};
reader.readAsText(file);
}

  setInterval(() => {
    let now = new Date();
    let currentHour = now.getHours();
    let currentMinute = now.getMinutes();

    // If it is 2 AM and the minute is greater than 0 (after 2 AM)
    if (currentHour === 2 && currentMinute === 0) { 
        let picker = document.getElementById("datePicker");
        let currentDate = new Date(picker.value);
        currentDate.setDate(currentDate.getDate() + 1);  // Set to the next day
        picker.value = currentDate.toISOString().split("T")[0];  // Update the date picker
        loadTasks();  // Reload the tasks for the new day
    }
}, 60000);  // Check every minute
  
loadTasks();
function prevDay(){
    let picker = document.getElementById("datePicker");
    let date = new Date(picker.value);
    date.setDate(date.getDate() - 1);
    picker.value = date.toISOString().split("T")[0]; // Ensure the format is correct
    loadTasks();
}

function nextDay(){
    let picker = document.getElementById("datePicker");
    let date = new Date(picker.value);
    date.setDate(date.getDate() + 1);
    picker.value = date.toISOString().split("T")[0]; // Ensure the format is correct
    loadTasks();
}
setInterval(() => {
    let now = new Date();
    let hours = now.getHours();

    if (hours === 2) {  // Check if it is 2 AM
        let picker = document.getElementById("datePicker");
        let currentDate = new Date(picker.value);
        currentDate.setDate(currentDate.getDate() + 1);  // Move to the next day
        picker.value = currentDate.toISOString().split("T")[0];  // Update date
        loadTasks();  // Reload tasks for the new day
    }
}, 60000);  // Check every minute
</script>








