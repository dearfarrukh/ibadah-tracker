<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ibadah Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>

body{
font-family:-apple-system,BlinkMacSystemFont;
background-image:url("wallpaper.jpg");
background-size:cover;
background-position:center;
background-repeat:no-repeat;
background-attachment:fixed;
margin:0;
padding:20px;
}

.card{
background:rgba(255,255,255,0.6);
backdrop-filter:blur(20px);
padding:18px;
border-radius:22px;
margin-bottom:20px;
}

button{
background:#007aff;
color:white;
border:none;
padding:12px;
border-radius:16px;
margin-top:10px;
width:100%;
}

.task{
display:flex;
justify-content:space-between;
padding:8px 0;
}

input[type="checkbox"]{
width:22px;
height:22px;
}

</style>
</head>

<body>

<h1 style="text-align:center;">ğŸ“¿ Ibadah Tracker</h1>

<div class="card">
<h3>ğŸ“… Select Date</h3>

<div style="display:flex;align-items:center;gap:10px;">

<button onclick="prevDay()" style="width:60px;">â¬…ï¸</button>

<input type="date" id="datePicker"
onchange="manualPickDate(this.value)"
style="width:40px;">

<div id="displayDate"
style="flex:1;text-align:center;font-weight:600;">
</div>

<button onclick="nextDay()" style="width:60px;">â¡ï¸</button>

</div>
</div>

<div class="card">
<h3>ğŸ“ Daily Tasks</h3>
<div id="taskContainer"></div>
</div>

<div class="card">
<h3>âš™ï¸ Task Settings</h3>

<select id="actionSelect" onchange="handleAction()">
<option value="">Select Action</option>
<option value="add">â• Add Task</option>
<option value="delete">ğŸ—‘ Delete Task</option>
<option value="rename">âœï¸ Rename Task</option>
</select>

<div id="actionArea"></div>

<h4>â˜ï¸ iCloud Backup</h4>

<button onclick="exportBackup()">Export to iCloud</button>

<input type="file" id="restoreFile"
onchange="importBackup()"
style="display:none;">

<button onclick="document.getElementById('restoreFile').click()">
Restore from iCloud
</button>

</div>

<div class="card">
<h3>ğŸ”¥ Streak</h3>
<p id="streakCount">0 Days</p>
</div>

<script>

let taskList=JSON.parse(localStorage.getItem("taskList"))||[
"Fajr","Dhuhur","Asr","Maghrib","Isha",
"Surah Mulk","Surah Sajdah","Surah Yaseen",
"Surah Rehman","Surah Taghabun","Surah Waqiya"
];

function islamicToday(){

let now=new Date();
let d=new Date(
now.getFullYear(),
now.getMonth(),
now.getDate()
);

if(now.getHours()<2){
d.setDate(d.getDate()-1);
}

return d;
}

function getLocalDate(){

let v=document.getElementById("datePicker").value;
let p=v.split("-");
return new Date(p[0],p[1]-1,p[2]);
}

function setDate(date){

let picker=document.getElementById("datePicker");

let key=date.getFullYear()+"-"+
String(date.getMonth()+1).padStart(2,"0")+"-"+
String(date.getDate()).padStart(2,"0");

picker.value=key;

document.getElementById("displayDate").innerText=
date.toLocaleDateString(
'en-US',
{weekday:'long',year:'numeric',month:'short',day:'numeric'}
);

loadTasks();
}

function loadTasks(){

let d=getLocalDate();

let key=d.getFullYear()+"-"+
String(d.getMonth()+1).padStart(2,"0")+"-"+
String(d.getDate()).padStart(2,"0");

let saved=JSON.parse(localStorage.getItem(key))||{};

let container=document.getElementById("taskContainer");
container.innerHTML="";

taskList.forEach(task=>{
let div=document.createElement("div");
div.className="task";
div.innerHTML=`
<label>${task}</label>
<input type="checkbox"
${saved[task]?"checked":""}
onchange="toggleTask('${task}',this.checked)">
`;
container.appendChild(div);
});

updateStreak();
}

function toggleTask(task,status){

let d=getLocalDate();

let key=d.getFullYear()+"-"+
String(d.getMonth()+1).padStart(2,"0")+"-"+
String(d.getDate()).padStart(2,"0");

let saved=JSON.parse(localStorage.getItem(key))||{};
saved[task]=status;
localStorage.setItem(key,JSON.stringify(saved));

updateStreak();
}

function prevDay(){
let d=getLocalDate();
d.setDate(d.getDate()-1);
setDate(d);
}

function nextDay(){
let d=getLocalDate();
d.setDate(d.getDate()+1);
setDate(d);
}

function manualPickDate(value){
let p=value.split("-");
let d=new Date(p[0],p[1]-1,p[2]);
setDate(d);
}

function handleAction(){

let action=document.getElementById("actionSelect").value;
let area=document.getElementById("actionArea");
area.innerHTML="";

if(action==="add"){
area.innerHTML=`
<input type="text" id="newTaskName">
<button onclick="confirmAdd()">Add</button>`;
}

if(action==="delete"){
let options=taskList.map(t=>`<option>${t}</option>`).join("");
area.innerHTML=`
<select id="deleteTaskSelect">${options}</select>
<button onclick="confirmDelete()">Delete</button>`;
}

if(action==="rename"){
let options=taskList.map(t=>`<option>${t}</option>`).join("");
area.innerHTML=`
<select id="renameSelect">${options}</select>
<input type="text" id="renameInput">
<button onclick="confirmRename()">Rename</button>`;
}
}

function confirmAdd(){
let name=document.getElementById("newTaskName").value.trim();
if(name){
taskList.push(name);
localStorage.setItem("taskList",JSON.stringify(taskList));
loadTasks();
}
}

function confirmDelete(){
let task=document.getElementById("deleteTaskSelect").value;
taskList=taskList.filter(t=>t!==task);
localStorage.setItem("taskList",JSON.stringify(taskList));
loadTasks();
}

function confirmRename(){
let old=document.getElementById("renameSelect").value;
let nw=document.getElementById("renameInput").value.trim();
if(nw){
taskList=taskList.map(t=>t===old?nw:t);
localStorage.setItem("taskList",JSON.stringify(taskList));
loadTasks();
}
}

function exportBackup(){
let data={taskList,storage:{}};
for(let i=0;i<localStorage.length;i++){
let key=localStorage.key(i);
data.storage[key]=localStorage.getItem(key);
}
let blob=new Blob([JSON.stringify(data)]);
let url=URL.createObjectURL(blob);
let a=document.createElement("a");
a.href=url;
a.download="ibadah-backup.json";
a.click();
}

function importBackup(){
let file=document.getElementById("restoreFile").files[0];
let reader=new FileReader();
reader.onload=function(e){
let data=JSON.parse(e.target.result);
localStorage.clear();
for(let key in data.storage){
localStorage.setItem(key,data.storage[key]);
}
location.reload();
};
reader.readAsText(file);
}

function updateStreak(){

let streak=0;
let today=islamicToday();

for(let i=0;i<365;i++){
let d=new Date(today);
d.setDate(today.getDate()-i);

let key=d.getFullYear()+"-"+
String(d.getMonth()+1).padStart(2,"0")+"-"+
String(d.getDate()).padStart(2,"0");

let saved=JSON.parse(localStorage.getItem(key));

if(saved && Object.values(saved).every(v=>v===true)){
streak++;
}else break;
}

document.getElementById("streakCount").innerText=
streak+" Days";
}

window.onload=function(){
setDate(islamicToday());
}

</script>
</body>
</html