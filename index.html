<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ibadah Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body{
font-family:-apple-system,BlinkMacSystemFont;
background:url("wallpaper.jpg") center/cover no-repeat fixed;
margin:0;
padding:20px;
}

.card{
background:rgba(255,255,255,0.6);
backdrop-filter:blur(20px);
padding:18px;
border-radius:22px;
margin-bottom:20px;
}

button{
background:#007aff;
color:white;
border:none;
padding:12px;
border-radius:16px;
width:60px;
min-width:60px;
}

.task{
display:flex;
justify-content:space-between;
padding:8px 0;
}

input[type="checkbox"]{
width:22px;
height:22px;
}
</style>
</head>

<body>

<h1 style="text-align:center;">ğŸ“¿ Ibadah Tracker</h1>

<!-- DATE CARD -->
<div class="card">

<div style="display:flex;align-items:center;gap:10px;">

<button onclick="prevDay()">â¬…ï¸</button>

<div style="flex:1;text-align:center;position:relative;">

<div id="displayDate" style="font-weight:600;"></div>
<div id="hijriDate" style="font-size:14px;color:gray;"></div>

<input type="date"
id="datePicker"
onchange="manualPick(this.value)"
style="
position:absolute;
top:0;
left:0;
width:100%;
height:100%;
opacity:0;
cursor:pointer;
z-index:5;
">

</div>

<button onclick="nextDay()">â¡ï¸</button>

</div>
</div>

<!-- TASKS -->
<div class="card">
<h3>ğŸ“ Daily Tasks</h3>
<div id="taskContainer"></div>
</div>

<!-- SETTINGS -->
<div class="card">
<h3>âš™ï¸ Task Settings</h3>

<select id="actionSelect" onchange="handleAction()">
<option value="">Select Action</option>
<option value="add">â• Add Task</option>
<option value="delete">ğŸ—‘ Delete Task</option>
<option value="rename">âœï¸ Rename Task</option>
</select>

<div id="actionArea"></div>

<h4>â˜ï¸ iCloud Backup</h4>

<button onclick="exportBackup()" style="width:100%;margin-bottom:10px;">Export</button>

<input type="file" id="restoreFile" onchange="importBackup()" style="display:none;">
<button onclick="document.getElementById('restoreFile').click()" style="width:100%">Restore</button>

</div>

<!-- STREAK -->
<div class="card">
<h3>ğŸ”¥ Prayer Streak</h3>
<p id="streakCount">0 Days</p>
</div>

<script>

let currentDate;

function todayKey(d){
let x=new Date(d);
x.setHours(0,0,0,0);
return x.getTime();
}

let taskList=JSON.parse(localStorage.getItem("taskList"))||[
{id:1,name:"Fajr",start:0,end:null},
{id:2,name:"Dhuhur",start:0,end:null},
{id:3,name:"Asr",start:0,end:null},
{id:4,name:"Maghrib",start:0,end:null},
{id:5,name:"Isha",start:0,end:null}
];

function saveTasks(){
localStorage.setItem("taskList",JSON.stringify(taskList));
}

function setDate(d){

currentDate=new Date(d);

document.getElementById("displayDate").innerText=
currentDate.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'short',day:'numeric'});

document.getElementById("datePicker").value=
currentDate.toISOString().split("T")[0];

loadTasks();

}

function manualPick(value){
setDate(new Date(value));
}

function loadTasks(){

let key=todayKey(currentDate);
let saved=JSON.parse(localStorage.getItem(key))||{};
let container=document.getElementById("taskContainer");
container.innerHTML="";

taskList.forEach(task=>{

if(key<task.start) return;
if(task.end && key>task.end) return;

let div=document.createElement("div");
div.className="task";

div.innerHTML=`
<label>${task.name}</label>
<input type="checkbox"
${saved[task.id]?"checked":""}
onchange="toggleTask(${task.id},this.checked)">
`;

container.appendChild(div);

});

updateStreak();

}

function toggleTask(id,status){

let key=todayKey(currentDate);
let saved=JSON.parse(localStorage.getItem(key))||{};
saved[id]=status;
localStorage.setItem(key,JSON.stringify(saved));
updateStreak();

}

function prevDay(){
currentDate.setDate(currentDate.getDate()-1);
setDate(currentDate);
}

function nextDay(){
currentDate.setDate(currentDate.getDate()+1);
setDate(currentDate);
}

function confirmAdd(){

let n=document.getElementById("newTaskName").value.trim();
if(!n) return;

let id=Date.now();

taskList.push({
id:id,
name:n,
start:todayKey(currentDate),
end:null
});

saveTasks();
loadTasks();

}

function confirmDelete(){

let t=document.getElementById("deleteTaskSelect").value;

let y=new Date(currentDate);
y.setDate(y.getDate()-1);

taskList=taskList.map(task=>{
if(task.id==t){
return {...task,end:todayKey(y)};
}
return task;
});

saveTasks();
loadTasks();

}

function handleAction(){

let action=document.getElementById("actionSelect").value;
let area=document.getElementById("actionArea");
area.innerHTML="";

if(action==="add"){
area.innerHTML=`<input id="newTaskName"><button onclick="confirmAdd()">Add</button>`;
}

if(action==="delete"){
let key=todayKey(currentDate);
let active=taskList.filter(t=>key>=t.start && (!t.end||key<=t.end));
let opt=active.map(t=>`<option value="${t.id}">${t.name}</option>`).join("");
area.innerHTML=`<select id="deleteTaskSelect">${opt}</select><button onclick="confirmDelete()">Delete</button>`;
}

}

function updateStreak(){

let streak=0;
let today=new Date();
today.setHours(0,0,0,0);

for(let i=0;i<365;i++){

let d=new Date(today);
d.setDate(today.getDate()-i);
let key=todayKey(d);

let saved=JSON.parse(localStorage.getItem(key))||{};
let valid=taskList.filter(t=>key>=t.start && (!t.end||key<=t.end));

if(valid.length===0) continue;

let done=valid.every(t=>saved[t.id]);
if(done) streak++;
else break;

}

document.getElementById("streakCount").innerText=streak+" Days";

}

document.addEventListener("DOMContentLoaded",()=>{
setDate(new Date());
});

</script>
</body>
</html>
