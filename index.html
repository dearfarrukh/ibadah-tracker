<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ibadah Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:-apple-system;background:#f2f2f7;margin:0;padding:20px}
.card{background:#fff;padding:16px;border-radius:16px;margin-bottom:16px}
.task{display:flex;justify-content:space-between;padding:8px 0}
</style>
</head>
<body>

<h2>ğŸ“¿ Ibadah Tracker</h2>

<div class="card">
<button onclick="prevDay()">â¬…ï¸</button>
<span id="date"></span>
<button onclick="nextDay()">â¡ï¸</button>
</div>

<div class="card">
<div id="tasks"></div>
</div>

<div class="card">
<input id="newTask" placeholder="New Task">
<button onclick="addTask()">Add</button>
<select id="del"></select>
<button onclick="delTask()">Delete</button>
</div>

<div class="card">
ğŸ”¥ Streak: <span id="streak">0</span>
</div>

<script>

let d=new Date();

function day(d){
let x=new Date(d);
x.setHours(0,0,0,0);
return x.getTime();
}

let tasks=JSON.parse(localStorage.getItem("tasks"))||[
{id:1,name:"Fajr",start:0,end:null},
{id:2,name:"Dhuhur",start:0,end:null},
{id:3,name:"Asr",start:0,end:null},
{id:4,name:"Maghrib",start:0,end:null},
{id:5,name:"Isha",start:0,end:null}
];

function save(){localStorage.setItem("tasks",JSON.stringify(tasks));}

function show(){

document.getElementById("date").innerText=d.toDateString();

let key=day(d);
let done=JSON.parse(localStorage.getItem(key))||{};
let html="";
let delOpt="";

tasks.forEach(t=>{
if(key<t.start) return;
if(t.end && key>t.end) return;

html+=`
<div class="task">
${t.name}
<input type="checkbox"
${done[t.id]?"checked":""}
onchange="tick(${t.id},this.checked)">
</div>`;

delOpt+=`<option value="${t.id}">${t.name}</option>`;
});

document.getElementById("tasks").innerHTML=html;
document.getElementById("del").innerHTML=delOpt;

streak();

}

function tick(id,v){
let key=day(d);
let done=JSON.parse(localStorage.getItem(key))||{};
done[id]=v;
localStorage.setItem(key,JSON.stringify(done));
streak();
}

function addTask(){
let n=document.getElementById("newTask").value.trim();
if(!n) return;
tasks.push({id:Date.now(),name:n,start:day(d),end:null});
save();
show();
}

function delTask(){
let id=document.getElementById("del").value;
let y=new Date(d);
y.setDate(y.getDate()-1);
tasks=tasks.map(t=>t.id==id?{...t,end:day(y)}:t);
save();
show();
}

function prevDay(){d.setDate(d.getDate()-1);show();}
function nextDay(){d.setDate(d.getDate()+1);show();}

function streak(){

let s=0;
let t=new Date();
t.setHours(0,0,0,0);

for(let i=0;i<365;i++){
let x=new Date(t);
x.setDate(t.getDate()-i);
let key=day(x);
let done=JSON.parse(localStorage.getItem(key))||{};
let valid=tasks.filter(tt=>key>=tt.start && (!tt.end||key<=tt.end));
if(valid.length===0) continue;
if(valid.every(tt=>done[tt.id])) s++;
else break;
}

document.getElementById("streak").innerText=s;

}

show();

</script>
</body>
</html>
