<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ibadah Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
body{
font-family:-apple-system;
background:url("wallpaper.jpg") center/cover no-repeat fixed;
margin:0;
padding:20px;
transition:0.4s;
}

.dark{
background:#111;
color:white;
}

.card{
background:rgba(255,255,255,0.65);
backdrop-filter:blur(20px);
padding:18px;
border-radius:22px;
margin-bottom:20px;
}

.dark .card{
background:rgba(0,0,0,0.5);
}

button{
background:#007aff;
color:white;
border:none;
padding:12px;
border-radius:16px;
width:60px;
}

.task{
display:flex;
justify-content:space-between;
padding:6px 0;
}

.progress{
height:10px;
background:#ddd;
border-radius:20px;
overflow:hidden;
margin-top:10px;
}

.progressFill{
height:100%;
background:#007aff;
width:0%;
}

</style>
</head>

<body>

<h2 style="text-align:center;">üìø Ibadah Tracker</h2>

<div class="card">

<div style="display:flex;align-items:center;gap:10px;">

<button onclick="prevDay()">‚¨ÖÔ∏è</button>

<div style="flex:1;text-align:center;position:relative;">

<div id="displayDate" style="font-weight:600;"></div>
<div id="hijriDate" style="font-size:13px;color:gray;"></div>

<input type="date" id="datePicker"
onchange="manualPick(this.value)"
style="position:absolute;top:0;left:0;width:100%;height:100%;opacity:0;">

</div>

<button onclick="nextDay()">‚û°Ô∏è</button>

</div>

<div class="progress">
<div id="progressFill" class="progressFill"></div>
</div>

</div>

<div class="card">
<div id="taskContainer"></div>
</div>

<div class="card">
<h4>Monthly Completion</h4>
<p id="monthPercent"></p>
</div>

<div class="card">
<h4>Prayer Streak</h4>
<p id="fajrStreak"></p>
<p id="asrStreak"></p>
<p id="ishaStreak"></p>
</div>

<div class="card">
<button onclick="exportBackup()" style="width:100%;margin-bottom:10px;">Export</button>
<input type="file" id="restoreFile" onchange="importBackup()" style="display:none;">
<button onclick="document.getElementById('restoreFile').click()" style="width:100%">Restore</button>
</div>

<script>

let currentDate;
let taskList=JSON.parse(localStorage.getItem("taskList"))||[
"Fajr","Dhuhur","Asr","Maghrib","Isha"
];

function islamicToday(){
let now=new Date();
let d=new Date(now.getFullYear(),now.getMonth(),now.getDate());
if(now.getHours()<2){d.setDate(d.getDate()-1);}
return d;
}

function formatKey(d){
return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0");
}

function setDate(d){

currentDate=new Date(d);

document.getElementById("displayDate").innerText=
currentDate.toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'short',day:'numeric'});

document.getElementById("hijriDate").innerText=
new Intl.DateTimeFormat('en-TN-u-ca-islamic',{day:'numeric',month:'long',year:'numeric'}).format(currentDate);

loadTasks();
}

function manualPick(v){
let p=v.split("-");
setDate(new Date(p[0],p[1]-1,p[2]));
}

function prevDay(){currentDate.setDate(currentDate.getDate()-1);setDate(currentDate);}
function nextDay(){currentDate.setDate(currentDate.getDate()+1);setDate(currentDate);}

function loadTasks(){

let key=formatKey(currentDate);
let saved=JSON.parse(localStorage.getItem(key))||{};
let container=document.getElementById("taskContainer");
container.innerHTML="";
let done=0;

taskList.forEach(task=>{
let checked=saved[task]||false;
if(checked)done++;
let div=document.createElement("div");
div.className="task";
div.innerHTML=`<label>${task}</label>
<input type="checkbox" ${checked?"checked":""}
onchange="toggleTask('${task}',this.checked)">`;
container.appendChild(div);
});

let percent=Math.round(done/taskList.length*100);
document.getElementById("progressFill").style.width=percent+"%";
monthReport();
}

function toggleTask(task,status){
let key=formatKey(currentDate);
let saved=JSON.parse(localStorage.getItem(key))||{};
saved[task]=status;
localStorage.setItem(key,JSON.stringify(saved));
loadTasks();
}

function monthReport(){
let month=currentDate.getMonth();
let year=currentDate.getFullYear();
let total=0;
let full=0;
for(let i=1;i<=31;i++){
let d=new Date(year,month,i);
if(d.getMonth()!=month)break;
total++;
let saved=JSON.parse(localStorage.getItem(formatKey(d)));
if(saved && Object.values(saved).every(v=>v))full++;
}
document.getElementById("monthPercent").innerText=
Math.round(full/total*100)+"% Completed";
}

function exportBackup(){
let data={taskList,storage:{}};
for(let i=0;i<localStorage.length;i++){
let key=localStorage.key(i);
data.storage[key]=localStorage.getItem(key);
}
let blob=new Blob([JSON.stringify(data)]);
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="backup.json";
a.click();
}

function importBackup(){
let file=document.getElementById("restoreFile").files[0];
let r=new FileReader();
r.onload=e=>{
let data=JSON.parse(e.target.result);
localStorage.clear();
for(let k in data.storage)localStorage.setItem(k,data.storage[k]);
location.reload();
};
r.readAsText(file);
}

setInterval(()=>{
let newDay=islamicToday();
if(formatKey(newDay)!=formatKey(currentDate)){
setDate(newDay);
}
},60000);

if(new Date().getHours()>19){document.body.classList.add("dark");}

document.addEventListener("DOMContentLoaded",()=>{
setDate(islamicToday());
});
</script>

</body>
</html>